var popcom=(function(){var core={};core.init=function(id_elm){var $popout=$('<div/>').attr('id','popcom_outer').css('display','none');var $closediv=$('<div/>').attr('id','popcom_closediv').html('<a id="popcom_cross" class="close"></a>');$popout.append($closediv);var $popinn=$('<div/>').attr('id','popcom_inner');var $hdr=$('<div/>').attr('id','popcom_hdr').html("<p>Pour toutes questions ou remarques, vous pouvez nous envoyer un message.</p><p>Si vous désirez une réponse, merci de renseigner votre adresse mail.</p>");var $comm=$('<span/>').addClass('pop_label').html('Votre message : ');var $inp_com=$('<textarea/>').addClass('pop_input').attr('id','popcom_comm').focus();var $mail=$('<span/>').addClass('pop_label').html('Votre mail (optionnel) : ');var $inp_mail=$('<input/>').addClass('pop_input').attr('id','popcom_mail');var $subm=$('<div />').attr('id',"popcom_submit").addClass("pop_but");var $but=$('<a />').attr("id","submit").html("<span id='subbut_txt'>Envoyer</span>");$subm.append($but);$popinn.append($hdr,$comm,$inp_com,$mail,$inp_mail,$subm);$popout.append($popinn);$('body').append($popout);var selink='#'+id_elm;$(selink).click(function(){$("#popcom_outer").fadeIn(400);$("#popcom_cross").click(function(){$('#popcom_resp').remove();$('#popcom_inner').show();$('#popcom_comm').val('');$('#popcom_mail').val('');$("#popcom_outer").fadeOut(10);});function submit_press(e){e.preventDefault();$(this).off('click');var comm=$('#popcom_comm').val();var mail=$('#popcom_mail').val();if(comm.length>0){comm=comm.replace(/(\r\n|\n|\r)/gm," ");core.send_msg(comm,mail);}else{$(this).on('click',submit_press);}}
$('#popcom_submit').click(submit_press);});};core.send_msg=function(comm,mail){function send_ok(){var $resp=$('<div/>').attr('id','popcom_resp').addClass('popcom_success').html('Message envoyé !');$('#popcom_inner').hide();$('#popcom_closediv').append($resp);}
function send_error(subjcomm){var $resp=$('<div/>').attr('id','popcom_resp').addClass('popcom_error').html("<p>Un problème est survenu lors de l'envoi du message.</p><p>Vous pouvez nous envoyer vos commentaires à l'adresse : <span class='black'>arnaud.rey@univ-amu.fr</span></p>");var $rlab=$('<span/>').addClass('pop_label').html('Votre message : ');var $resc=$('<textarea/>').addClass('pop_input pop_resc').attr('id','popresc_txt').val(subjcomm).focus();var $copybut=$('<div />').attr('id',"popcom_copy").addClass("pop_but").click(function(){$('#popresc_txt').focus().select();document.execCommand('copy');$('#popresc_txt').off("select");var $okcopy=$('<p/>').attr('id','okcopy').addClass('green').html('Copié !');$('#popcom_resp').append($okcopy);$('#okcopy').fadeOut(1200,function(){$('#okcopy').remove();});});var $cbut=$('<a />').html("<span id='pop_coptxt'>Copier le message dans le presse-papier</span>");$copybut.append($cbut);$resp.append($rlab,$resc,$copybut);$('#popcom_inner').hide();$('#popcom_closediv').append($resp);}
$.ajax({type:"GET",cache:false,url:"db/popcom_send.php",data:{comment:comm,mail:mail},success:function(){send_ok();if(window.console)console.log("Message sent");},error:function(){send_error(comm);}});};return core;})();