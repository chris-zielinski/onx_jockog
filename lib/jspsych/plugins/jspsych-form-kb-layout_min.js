jsPsych.plugins["form-kb-layout"]=(function(){var plugin={};function define_trial(params){var idn=(typeof params.idname=='undefined')?"kblay_form":params.idname;var qstr=(typeof params.quest=='undefined')?"":params.quest;var pbar=(typeof params.progbarstr=='undefined')?"":params.progbarstr;var subm=(typeof params.submit=='undefined')?"Valider":params.submit;var lay=params.layout;var nlay=lay.length;var formlay=[];for(var i=0;i<nlay;i++){var sublay=lay[i];var oid=(typeof sublay.opt_id=='undefined')?("lay_"+i):sublay.opt_id;var ostr=(typeof sublay.opt_str=='undefined')?("Layout "+i):sublay.opt_str;var is_img=(typeof sublay.img=='undefined')?false:true;var imgpath=(typeof sublay.img=='undefined')?"":sublay.img;var is_msk=(typeof sublay.msk=='undefined')?false:true;var mskpath=(typeof sublay.msk=='undefined')?"":sublay.msk;var is_inp=(typeof sublay.opt_input=='undefined')?false:true;var inp_obj=[];var optfunc=0;var condclass="";if(is_inp){var io=sublay.opt_input;var nch=(typeof io.input_char=='undefined')?20:io.input_char;var ishid=(typeof io.is_conditional=='undefined')?false:true;if(ishid){optfunc=1;condclass='hiderow cond_'+oid;}
inp_obj={quest:(typeof io.quest=='undefined')?"PrÃ©cisez : ":io.quest,inpwidth:Math.floor(nch*0.7),ishidden:ishid,condclass:condclass};}
formlay.push({opt_str:ostr,opt_id:oid,is_img:is_img,img_path:imgpath,is_msk:is_msk,msk_path:mskpath,is_inp:is_inp,inp_obj:inp_obj,optfunc:optfunc});}
var trials={progbar:pbar,idname:idn,quest:qstr,layout:formlay,submit:subm};return trials;}
function addoptfunc(isfunc,$opt){if(isfunc===1){var rnam=$opt.attr('name');var idtrig=$opt.attr('id');$opt.click(function(){$(".cond_"+idtrig).removeClass("hiderow");$('[name='+rnam+']').each(function(){var idopt=$(this).attr('id');$(this).click(function(){if($('#'+idtrig).is(":checked")==true){$(".cond_"+idtrig).removeClass("hiderow");}else{$(".cond_"+idtrig).addClass("hiderow");}});});});}
return $opt;}
var layout_form=function(trial,display_element){var lay={};var idname=trial.idname;lay.init=function(){display_element.html(' ');display_element.append(trial.progbar);var $preamb=$('<div/>').attr("id","preamb").html(trial.preamble).addClass("form_preamble");var $formdiv=$('<div/>').attr("id","theform").css("text-align","left").addClass("kbform_div");display_element.append($formdiv);var $quest=$('<span/>').addClass("kbform_quest").html(trial.quest);$('#theform').append($quest);};lay.disp_radio=function(elm){var $rowdiv=$('<div/>').attr('id','rowdiv_'+elm.opt_id).addClass('kbform_row');var $radiv=$('<div/>').addClass('kbform_rad');var $opt_lab=$('<label/>').attr("id","lab"+elm.opt_id).attr("for",elm.opt_id).html(elm.opt_str).addClass("radio_lab");var $opt_inp=$('<input/>').attr("type","radio").attr("id",elm.opt_id).attr("name",idname).attr("value",elm.opt_id).addClass("radio_but").addClass("form_resp");$opt_inp=addoptfunc(elm.optfunc,$opt_inp);$radiv.append($opt_lab);$rowdiv.append($radiv);$('#theform').append($rowdiv);$('#lab'+elm.opt_id).prepend($opt_inp);};lay.disp_img=function(imgpath,idrad){var $imgcont=$('<div/>').addClass('kbform_img');var $lay_img=$('<img/>').addClass("layout_img lay_main").attr('data-idrad',idrad).attr("id","img_"+idrad).attr("src",imgpath);var $labimg=$('<label/>').attr("for",idrad);$labimg.append($lay_img);$imgcont.append($labimg);$('#rowdiv_'+idrad).append($imgcont);};lay.disp_msk=function(mskpath,idrad){var $imgcont=$('<div/>').addClass('kbform_img');var $mask=$('<img/>').addClass("layout_img lay_msk").attr("id","msk_"+idrad).attr("src",mskpath);var $labmsk=$('<label/>').attr("for",idrad);$labmsk.append($mask);$imgcont.append($labmsk);$('#rowdiv_'+idrad).append($imgcont);};lay.disp_input=function(inpobj,idrad){var $txt_quest=$('<label/>').attr("for",idrad).addClass(inpobj.condclass).html(inpobj.quest).css('margin-right','1em');var $txt_inp=$('<input/>').attr("type",'text').attr("id",'resp_'+idrad).attr("name",'inp_'+idrad).attr("style","width:"+inpobj.inpwidth+"em").addClass(inpobj.condclass).addClass("form_resp").addClass("lay_input");var $inpdiv=$('<div/>').attr('id','inpdiv_'+idrad).addClass('lay_inpdiv');$inpdiv.append($txt_quest,$txt_inp);$('#rowdiv_'+idrad).append($inpdiv);};return lay;};plugin.trial=function(display_element,params){trial=define_trial(params);trial=jsPsych.pluginAPI.evaluateFunctionParameters(trial);var layform=layout_form(trial,display_element);var layobj=trial.layout;var Nkb=layobj.length;layform.init();for(var j=0;j<Nkb;j++){var layo=layobj[j];layform.disp_radio(layo);var id_rad=layo.opt_id;if(layo.is_img){layform.disp_img(layo.img_path,id_rad);}
if(layo.is_msk){layform.disp_msk(layo.msk_path,id_rad);}
if(layo.is_inp){layform.disp_input(layo.inp_obj,id_rad);}}
var hform=$('body').height();var hrow=Math.round(hform/4.5);$('.kbform_row').css('height',hrow);$('.kbform_img').css('height',hrow);$(":radio").each(function(){$(this).click(function(){var gid=$(this).attr('id');$(".lay_main").show();$("#img_"+gid).hide();$('.radio_lab').removeClass('blue');$("#lab"+gid).addClass('blue');if(!($('#resp_'+gid).length)){$('.lay_input').val('');}});});$('.lay_inpdiv').click(function(){var rid=$(this).attr('id');var gid=rid.slice("inpdiv_".length);$('#'+gid).prop('checked',true);$('.radio_lab').removeClass('blue');$("#lab"+gid).addClass('blue');$(".lay_main").show();});$('.lay_input').focus(function(){var rid=$(this).attr('id');var gid=rid.slice("resp_".length);$('#'+gid).prop('checked',true);$('.radio_lab').removeClass('blue');$("#lab"+gid).addClass('blue');$(".lay_main").show();});$(".kbform_row").each(function(){var rid=$(this).attr('id');var gid=rid.slice("rowdiv_".length);$(this).hover(function(){$("#img_"+gid).hide();$("#lab"+gid).addClass('blue');},function(){if($("#"+gid).is(":checked")!==true){$("#img_"+gid).show();$("#lab"+gid).removeClass('blue');}});});var $subm=$('<div />').attr('id',"subbut").addClass("form_subbutton lay_but");var $but=$('<a />').attr("id","submit").addClass('button').html("<span id='subbut_txt'>"+trial.submit+"</span>");$('#theform').append($subm);$('#subbut').append($but);$("#submit").click(function(){var idn=trial.idname;var layresp=idn;$(".form_resp").each(function(){var intyp=$(this).attr("type");var fname=$(this).attr("name");var val=$(this).val();if((intyp=="radio")&&($(this).is(":checked")==true)){if(val==""){val="NA";}
layresp+='_'+val;}
if((intyp=='text')&&(val.length>0)){val=val.replace(/\s+/g,'');layresp+='_'+val;}});if(layresp===idn){layresp+='_NA';}
form_data={"layout":layresp};display_element.html('');jsPsych.finishTrial(form_data);});};return plugin;})();