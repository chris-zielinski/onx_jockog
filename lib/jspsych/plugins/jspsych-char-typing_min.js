jsPsych.plugins["char-typing"]=(function(){var plugin={};plugin.trial=function(display_element,trial){trial.timing_post_trial=(typeof trial.timing_interstim==='undefined')?0:trial.timing_interstim;var charlist=trial.char_stim;var Nchar=charlist.length;var getkb=function(callback_function){var listener_function=function(e){var key_time=performance.now();$stimdiv.html('');setTimeout(function(){callback_function({key:e.which,rt:Math.round(key_time-start_time)});},100);var after_up=function(up){if(up.which==e.which){$(document).off('keyup',after_up);}};$(document).keyup(after_up);};$(document).keydown(listener_function);return{type:'keydown',fn:listener_function}};display_element.html('');display_element.removeClass('bg_og').addClass('hidecursor bg_grey');var $stimdiv=$('<div/>').attr('style','padding-bottom: 10px').attr('id','jspsych-char-stimulus');display_element.append($stimdiv);function display_char(chardisp,cb_func){$stimdiv.html(chardisp);return performance.now();}
var istim=0;var responseTimes=[];var responseChars="";var responseValidity=[];var end_trial=function(){jsPsych.pluginAPI.cancelKeyboardResponse(kb_listener);var nval=responseValidity.reduce(function(ss,x){return(ss+x);},0);var trial_data={"stim":charlist,"kc":responseChars,"rt":JSON.stringify(responseTimes),"nvld":nval};display_element.html('');jsPsych.finishTrial(trial_data);};var after_response=function(info){if(responseTimes.length<=Nchar){responseTimes.push(info.rt);var rchar=String.fromCharCode(info.key);responseChars=responseChars+rchar;if(rchar==charlist[istim]){responseValidity.push(1);}else{responseValidity.push(0);}
istim++;if(istim+1<=Nchar){start_time=display_char(charlist[istim]);}else{display_element.removeClass('hidecursor bg_grey');end_trial();}}else{end_trial();};};var start_time=display_char(charlist[0]);var kb_listener=getkb(after_response);};return plugin;})();